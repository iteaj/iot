<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">
    <description>协议层 jetty web 服务端 Spring配置</description>

    <bean id="testServlet" class="com.iteaj.network.server.http.PassportServlet" />
    <!-- 设备访问记录,设备提交的进出门的访问记录 -->
    <bean id="recordServlet" class="com.iteaj.network.server.http.AccessRecordServlet" />
    <!-- 控制设备操作 -->
    <bean id="controlServlet" class="com.iteaj.network.server.http.DeviceControlServlet" />
    <!-- 海天人员进出港接口 -->
    <bean id="haitianServlet" class="com.iteaj.network.server.http.HaitianServlet">
        <property name="keyId" value="" />
        <property name="password" value="" />
        <property name="userCode" value="" />
        <property name="ipMappers">
            <list>
                <bean class="com.iteaj.network.server.http.HaitianServlet.IpMapper">
                    <property name="type" value="入口" />
                    <property name="faceIp" value="172.16.149.161" />
                    <property name="gateIp" value="172.16.149.154" />
                </bean>
                <bean class="com.iteaj.network.server.http.HaitianServlet.IpMapper">
                    <property name="type" value="出口" />
                    <property name="faceIp" value="172.16.149.162" />
                    <property name="gateIp" value="172.16.149.155" />
                </bean>
            </list>
        </property>
        <property name="ledUserUrl" value="http://172.16.149.158:8080/auth/user" />
        <property name="url" value="http://172.16.145.131/handler/ajaxPublic.ashx" />
        <property name="ledResultUrl" value="http://172.16.149.158:8080/auth/result" />
    </bean>

    <!-- ServletHandler管理所有Servlet的访问已经对应关系 -->
    <bean id="servletHandler" class="org.eclipse.jetty.servlet.ServletHandler">
        <!-- 配置servlet -->
        <property name="servlets">
            <list>
                <bean class="org.eclipse.jetty.servlet.ServletHolder">
                    <property name="name" value="testServlet" />
                    <property name="servlet" ref="testServlet" />
                </bean>
                <bean class="org.eclipse.jetty.servlet.ServletHolder">
                    <property name="name" value="recordServlet" />
                    <property name="servlet" ref="recordServlet" />
                </bean>
                <bean class="org.eclipse.jetty.servlet.ServletHolder">
                    <property name="name" value="controlServlet" />
                    <property name="servlet" ref="controlServlet" />
                </bean>
                <!-- 海天人员进出港限制接口 -->
                <bean class="org.eclipse.jetty.servlet.ServletHolder">
                    <property name="name" value="haitianServlet" />
                    <property name="servlet" ref="haitianServlet" />
                </bean>
            </list>
        </property>
        <property name="servletMappings">
            <list>
                <!-- Jetty测试用例 -->
                <bean class="org.eclipse.jetty.servlet.ServletMapping">
                    <property name="servletName" value="testServlet" />
                    <property name="pathSpec" value="/edoor/uid/iteaj"/>
                </bean>
                <bean class="org.eclipse.jetty.servlet.ServletMapping">
                    <property name="servletName" value="recordServlet" />
                    <property name="pathSpec" value="/edoor/api/IntoRecord"/>
                </bean>
                <bean class="org.eclipse.jetty.servlet.ServletMapping">
                    <property name="servletName" value="controlServlet" />
                    <property name="pathSpec" value="/edoor/manager/control" />
                </bean>
                <!-- 海天人员进出港下发权限接口 -->
                <bean class="org.eclipse.jetty.servlet.ServletMapping">
                    <property name="servletName" value="haitianServlet" />
                    <property name="pathSpecs">
                        <array>
                            <value>/haitian/api/WorkerAuthorization</value>
                            <value>/haitian/api/CarNo</value>
                        </array>
                    </property>
                </bean>
            </list>
        </property>

        <!-- 配置过滤器 -->
        <property name="filters" >
            <list>
                <bean class="org.eclipse.jetty.servlet.FilterHolder">
                    <property name="name" value="encodingFilter" />
                    <property name="filter">
                        <bean class="com.iteaj.network.server.http.CharacterEncodingFilter">
                            <property name="forceEncoding" value="true" />
                        </bean>
                    </property>
                </bean>
            </list>
        </property>
        <property name="filterMappings">
            <list>
                <bean class="org.eclipse.jetty.servlet.FilterMapping">
                    <property name="pathSpec" value="/*" />
                    <property name="filterName" value="encodingFilter" />
                </bean>
            </list>
        </property>
    </bean>

    <!-- 管理ServletHandler-->
    <bean id="servletContextHandler" class="org.eclipse.jetty.servlet.ServletContextHandler">
        <property name="contextPath" value="/" />
        <property name="servletHandler" ref="servletHandler" />
    </bean>

    <!-- 创建一个jetty服务 -->
    <bean id="Server" class="org.eclipse.jetty.server.Server" init-method="start" destroy-method="stop">
        <constructor-arg name="port" value="8089" />
        <property name="handler" ref="servletContextHandler" />
    </bean>

</beans>
